services:
  backend:
    build: ./backend
    container_name: rtlsdr-backend
    restart: unless-stopped
    privileged: true
    devices:
      - /dev/bus/usb:/dev/bus/usb
    volumes:
      - ./backend/data:/app/data
    environment:
      - EXTERNAL_STREAM_URL=${EXTERNAL_STREAM_URL:-}
      - DEFAULT_STATIONS=${DEFAULT_STATIONS:-all}  # Options: fm, dab, all, none
    ports:
      - "9080:9080"
      - "8089:8089"
    networks:
      - rtlsdr-dev

  frontend:
    build: ./frontend
    container_name: rtlsdr-frontend
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "80:80"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - rtlsdr-dev

  music-assistant:
    build: ./music_assistant_provider
    container_name: music-assistant
    restart: unless-stopped
    depends_on:
      - backend
    volumes:
      - ./music_assistant_data:/data
    environment:
      - LOG_LEVEL=debug
    ports:
      - "8095:8095"
    networks:
      - rtlsdr-dev

networks:
  rtlsdr-dev:
    driver: bridge
